# ğŸ”§ ç™»å½•è·³è½¬é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸ› é—®é¢˜ç°è±¡
ç™»å½•æˆåŠŸåï¼Œæ˜¾ç¤º"ç™»å½•æˆåŠŸï¼"æ¶ˆæ¯ï¼Œä½†é¡µé¢ä¸è·³è½¬åˆ°ç”¨æˆ·ç®¡ç†é¡µé¢

## ğŸ” å¯èƒ½çš„åŸå› 

### 1. å¼‚æ­¥çŠ¶æ€é—®é¢˜
- Tokenè®¾ç½®å’Œç”¨æˆ·ä¿¡æ¯è·å–æ˜¯å¼‚æ­¥çš„
- è·¯ç”±è·³è½¬å¯èƒ½åœ¨çŠ¶æ€æ›´æ–°å‰æ‰§è¡Œ

### 2. è·¯ç”±å®ˆå«å†²çª
- è·¯ç”±å®ˆå«å¯èƒ½é˜»æ­¢äº†è·³è½¬
- fetchUserå¤±è´¥ä½†æ²¡æœ‰æŠ›å‡ºé”™è¯¯

### 3. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- å¯èƒ½æœ‰JavaScripté”™è¯¯é˜»æ­¢äº†è·³è½¬

## âœ… è§£å†³æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾ï¼š

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—ï¼š**
```
å¼€å§‹ç™»å½•...
ç™»å½•APIè°ƒç”¨æˆåŠŸï¼Œtoken: eyJ...
Tokenå·²ä¿å­˜åˆ°store
ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ: {username: "admin", ...}
å‡†å¤‡è·³è½¬åˆ° /users
è·³è½¬å‘½ä»¤å·²æ‰§è¡Œ
```

**å¦‚æœæ²¡æœ‰çœ‹åˆ°å®Œæ•´æ—¥å¿—ï¼Œè¯´æ˜åœ¨å“ªä¸€æ­¥å‡ºé”™äº†ã€‚**

### æ­¥éª¤2: æ£€æŸ¥Networkæ ‡ç­¾
1. æ‰“å¼€Networkæ ‡ç­¾
2. è¾“å…¥è´¦å·å¯†ç ï¼Œç‚¹å‡»ç™»å½•
3. æ£€æŸ¥è¯·æ±‚ï¼š
   - âœ… `/api/auth/login` - åº”è¯¥è¿”å›200ï¼Œæœ‰access_token
   - âœ… `/api/auth/me` - åº”è¯¥è¿”å›200ï¼Œæœ‰ç”¨æˆ·ä¿¡æ¯
   
**å¦‚æœæœ‰è¯·æ±‚å¤±è´¥ï¼ˆçº¢è‰²ï¼‰ï¼Œè®°ä¸‹é”™è¯¯ä¿¡æ¯ã€‚**

### æ­¥éª¤3: æ‰‹åŠ¨æµ‹è¯•è·¯ç”±
åœ¨æµè§ˆå™¨Consoleä¸­è¾“å…¥ï¼š
```javascript
// æ£€æŸ¥token
localStorage.getItem('token')

// æ‰‹åŠ¨è·³è½¬
window.location.href = '/users'
```

## ğŸ¯ æˆ‘åšçš„ä¿®å¤

### 1. ç§»é™¤äº†setTimeout
```javascript
// ä¹‹å‰ âŒ
setTimeout(() => {
  router.replace('/users')
}, 500)

// ç°åœ¨ âœ…
await router.push('/users')
```

### 2. æ·»åŠ äº†è¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—
```javascript
console.log('å¼€å§‹ç™»å½•...')
console.log('ç™»å½•APIè°ƒç”¨æˆåŠŸï¼Œtoken:', response.access_token)
console.log('Tokenå·²ä¿å­˜åˆ°store')
console.log('ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ:', userStore.user)
console.log('å‡†å¤‡è·³è½¬åˆ° /users')
console.log('è·³è½¬å‘½ä»¤å·²æ‰§è¡Œ')
```

### 3. ç¡®ä¿å¼‚æ­¥æ“ä½œæŒ‰é¡ºåºæ‰§è¡Œ
```javascript
// 1. ç™»å½•è·å–token
const response = await login(loginForm)
// 2. ä¿å­˜token
userStore.setToken(response.access_token)
// 3. è·å–ç”¨æˆ·ä¿¡æ¯
await userStore.fetchUser()
// 4. è·³è½¬
await router.push('/users')
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æµ‹è¯•1: æ­£å¸¸ç™»å½•æµç¨‹
1. æ‰“å¼€ http://localhost:1212
2. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰**
3. è¾“å…¥ `admin` / `admin`
4. ç‚¹å‡»"ç«‹å³ç™»å½•"
5. **æŸ¥çœ‹Consoleæ—¥å¿—**
6. åº”è¯¥è‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç®¡ç†é¡µé¢

### æµ‹è¯•2: æ£€æŸ¥åç«¯
```bash
# æµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:2121/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'

# åº”è¯¥è¿”å›ç±»ä¼¼ï¼š
# {"access_token":"eyJ...","token_type":"bearer"}
```

### æµ‹è¯•3: æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯æ¥å£
```bash
# å…ˆç™»å½•è·å–token
TOKEN="ä½ çš„token"

# æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯
curl -X GET http://localhost:2121/api/auth/me \
  -H "Authorization: Bearer $TOKEN"

# åº”è¯¥è¿”å›ç”¨æˆ·ä¿¡æ¯
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: æ§åˆ¶å°æ˜¾ç¤º "ç™»å½•APIè°ƒç”¨æˆåŠŸ" åå°±æ²¡æœ‰æ—¥å¿—äº†
**A:** è¯´æ˜ `fetchUser()` å¤±è´¥äº†
- æ£€æŸ¥ `/api/auth/me` æ¥å£æ˜¯å¦æ­£å¸¸
- æ£€æŸ¥åç«¯æ˜¯å¦è¿”å›äº†æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯

### Q2: æ§åˆ¶å°æ˜¾ç¤º "å‡†å¤‡è·³è½¬" åæ²¡æœ‰ "è·³è½¬å‘½ä»¤å·²æ‰§è¡Œ"
**A:** è¯´æ˜ `router.push()` å¤±è´¥äº†
- æ£€æŸ¥è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ˜¯å¦æœ‰è·¯ç”±å®ˆå«é˜»æ­¢äº†è·³è½¬

### Q3: æ‰€æœ‰æ—¥å¿—éƒ½æ˜¾ç¤ºäº†ï¼Œä½†é¡µé¢è¿˜æ˜¯æ²¡è·³è½¬
**A:** å¯èƒ½æ˜¯è·¯ç”±å®ˆå«é—®é¢˜
- æ£€æŸ¥ `/frontend/src/router/index.ts` çš„ `beforeEach` å®ˆå«
- å°è¯•åœ¨æµè§ˆå™¨åœ°å€æ ç›´æ¥è¾“å…¥ `http://localhost:1212/users`

### Q4: å‡ºç° "Cannot read properties of null"
**A:** Storeå¯èƒ½æ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–
- æ£€æŸ¥ Pinia æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥ `main.ts` æ˜¯å¦æ­£ç¡®æ³¨å†Œäº† Pinia

## ğŸ“ æ£€æŸ¥æ¸…å•

è¿è¡Œç³»ç»Ÿå‰ï¼Œç¡®ä¿ï¼š
- âœ… åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:2121`
- âœ… å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:1212`
- âœ… MySQLæ•°æ®åº“æ­£åœ¨è¿è¡Œ
- âœ… adminç”¨æˆ·å·²åˆ›å»ºï¼ˆè¿è¡Œ `python init_db.py`ï¼‰
- âœ… æµè§ˆå™¨å¼€å‘è€…å·¥å…·å·²æ‰“å¼€ï¼ˆF12ï¼‰

## ğŸ†˜ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æµè§ˆå™¨Consoleçš„å®Œæ•´æ—¥å¿—ï¼ˆæˆªå›¾ï¼‰
2. Networkæ ‡ç­¾çš„è¯·æ±‚åˆ—è¡¨ï¼ˆæˆªå›¾ï¼‰
3. æ˜¯å¦æœ‰ä»»ä½•çº¢è‰²é”™è¯¯ä¿¡æ¯
4. ä½¿ç”¨çš„æµè§ˆå™¨å’Œç‰ˆæœ¬

---

**ä¿®å¤æ—¶é—´**: 2025-11-14  
**ç›¸å…³æ–‡ä»¶**: `/frontend/src/views/Login.vue`

